name: Upstream

on:
  workflow_dispatch:
    branches:
      - master
  push:
    branches:
      - master

jobs:
  build:
    name: Automatic upstream
    runs-on: ubuntu-20.04
    steps:
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install git
    - name: Upstream branches
      run: |
        git config --global user.name "${GH_USER}"
        git config --global user.email "${GH_USER}@users.noreply.github.com"
        git clone https://"${GH_USER}":"${GH_TOKEN}"@github.com/"${GITHUB_REPOSITORY}" releases
        cd releases
        git remote add jarl https://github.com/JarlPenguin/releases
        git fetch jarl
        function upstream() { for var in cedric-los18 montana-los18 montana-los18-4.9 river-los17; do git checkout origin/$var; git rebase jarl/master; git push -f origin HEAD:$var; done; git checkout master; }
        upstream
      env:
        GH_TOKEN: ${{ secrets.GH_TOKEN }}
        GH_USER: ${{ secrets.GH_USER }}
